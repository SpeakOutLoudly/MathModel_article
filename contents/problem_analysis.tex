\chapter[\hspace{0pt}问题分析]{{\heiti\zihao{3}\hspace{0pt}问题分析}}

\removelofgap
\removelotgap

\section[\hspace{-2pt}问题重述]{{\heiti\zihao{-3} \hspace{-8pt}问题重述}}\label{section2: 问题重述}

\section[\hspace{-2pt}模型假设]{{\heiti\zihao{-3} \hspace{-8pt}模型假设}}\label{section2: 模型假设}


\section[\hspace{-2pt}符号定义]{{\heiti\zihao{-3} \hspace{-8pt}符号定义}}\label{section2: 符号定义}



\section[\hspace{-2pt}理论基础]{{\heiti\zihao{-3} \hspace{-8pt}理论基础}}\label{section2: 理论基础}


为了便于对后续视频源BT.2020色域与普通显示屏RGB色域之间映射关系的分析，我们首先引入标准色度系统的数学模型，对常见色彩空间进行建模表示。这些空间构成了本问题中色彩转换和损失评估的基础框架。

\subsection[\hspace{-2pt}CIE1931标准色度观察者与光谱三刺激值]{{\heiti\zihao{4} \hspace{-8pt}CIE1931标准色度观察者与光谱三刺激值}}\label{section2: CIE1931标准色度观察者与光谱三刺激值}
CIE 1931是是由国际照明委员会（CIE）于1931年定义的色彩模型，其核心在于基于实验测量建立的“标准色度观察者”响应曲线。这一模型通过三条匹配函数 $\overline{x}(\lambda),\overline{y}(\lambda),\overline{z}(\lambda) $ 将任意波长下的光谱功率分布（SPD）映射为三刺激值（Tristimulus Values）：
\begin{equation}
\begin{aligned}
  &X = \int_{\lambda}S(\lambda)\overline{x}(\lambda)d\lambda,\ \ \ Y = \int_{\lambda}S(\lambda)\overline{y}(\lambda)d\lambda,\ \ \ Z = \int_{\lambda}S(\lambda)\overline{z}(\lambda)d\lambda
\end{aligned}
\end{equation}

\subsection[\hspace{-2pt}CIEXYZ颜色空间]{{\heiti\zihao{4} \hspace{-8pt}CIEXYZ颜色空间}}\label{section2: CIEXYZ颜色空间}
CIEXYZ 是一个以三刺激值为基础的线性色彩空间，被视为“设备无关”的色彩表示方式。其三个分量 $(X,Y,Z)$ 分别对应红、绿、蓝三种感知通道。Y 分量也通常用作\textbf{亮度（Luminance）}的代表。该空间是许多其他色彩空间（如 Lab、sRGB、BT.2020）的中间标准基础。通常不同色域之间的转换以此为中介。

\subsection[\hspace{-2pt}CIELab颜色空间]{{\heiti\zihao{4} \hspace{-8pt}CIELab颜色空间}}\label{section2: CIELab颜色空间}
CIELab 空间是基于 CIEXYZ 空间定义的感知均匀色彩空间，能够更好地符合人眼对颜色差异的敏感性。其由以下三个分量构成：
\begin{equation}
\begin{aligned}
  &L^{*}\ ,\ \ a^{*}\ ,\ \ b^P{*}\ 
\end{aligned}
\end{equation}
其中，$L^{*}$代表明度，$a^{*}$代表红绿轴，$b^{*}$代表黄蓝轴。具体变换公式如下（以D65白点为例）：
\begin{equation}
\begin{aligned}
  &f(t) = 
\begin{cases}
  t^{\frac{1}{3}}\ \ \ \ t>\delta^{3}\\
  \frac{t}{3\delta^{2}}+\frac{4}{29}\ \ \ \ t\leq \delta^{3}\\
\end{cases}
,\ \ \delta=\frac{6}{29}
\end{aligned}
\end{equation}

\begin{equation}
\begin{aligned}
  &L^{*} = 116f(\frac{Y}{Y_{n}})-16,\ \ \ a^{*}=500[f(\frac{X}{X_{n}})-f(\frac{Y}{Y_{n}})],\ \ \ b^{*} = 200[f(\frac{Y}{Y_{n}})-f(\frac{Z}{Z_{n}})]
\end{aligned}
\end{equation}

其中$(X_{n},Y_{n},Z_{n})$ 为参考白点（如D65）的三刺激值。

\subsection[\hspace{-2pt}CIE1931xy色度图与色域表示]{{\heiti\zihao{4} \hspace{-8pt}CIE1931xy色度图与色域表示}}\label{section2: CIE1931xy色度图与色域表示}
CIEXYZ 空间中颜色可以通过如下变换得到色度图中的坐标：

\begin{equation}
\begin{aligned}
  &x=\frac{X}{X+Y+Z},\ \ y=\frac{Y}{X+Y+Z}
\end{aligned}
\end{equation}

该色度图表示了所有可见光的二维投影范围，设备的色域可以通过其三基色的 $(x,y)$ 点连线形成三角形表示。色域越大，所能表示的颜色越丰富。该图是色彩匹配与色彩损失分析的重要工具。

\subsection[\hspace{-2pt}CIEDE2000色差公式]{{\heiti\zihao{4} \hspace{-8pt}CIEDE2000色差公式}}\label{section2: CIEDE2000色差公式}


为了更精确的对问题进行建模并且便于后续损失函数以及差分进化算法的实现，我们将题目中的BT.2020颜色空间以及显示屏的颜色空间从 xy 色度坐标转换为 XYZ 颜色空间，再利用 Lab 颜色空间公式转换为 $(L^{*},a^{*},b^{*})$ 。最后计算 $\Delta E_{00}$ 损失值。

在将 BT.2020 高清视频源的色彩空间映射至普通显示屏 RGB 色域时，由于显示设备色域较小，无法完整覆盖原始色域，导致部分颜色无法被准确再现。因此，我们需要设计一个合理的\textbf{色彩转换映射矩阵} $M\in \mathbb{R}^{3\times 3}$ ,以最小化从 BT.2020 色域到显示屏色域的映射过程中所产生的\textbf{主观感知误差}。

为度量这一色彩差异，应选择符合人眼视觉感知的度量方式。传统的欧几里得差异（如 RGB 或 XYZ 空间中的 L2 距离）不能很好地反映颜色感知误差。我们引入国际照明委员会（CIE）推荐的 $\Delta E_{00}$ 作为感知误差的度量函数。

对任意两个颜色在Lab空间中的向量：
\begin{equation}
\begin{aligned}
  &Lab_{1} = (L^{*}_{1},a^{*}_{1},b^{*}_{1}),\ \ \ Lab_{2}=(L^{*}_{2},a^{*}_{2},b^{*}_{2})
\end{aligned}
\end{equation}

$\Delta E_{00}$ 的计算公式如下：
\begin{equation}
\begin{aligned}
  &\Delta E_{00}=\sqrt{(\frac{\Delta L^{'}}{k_{L}S_{L}})^{2}+(\frac{\Delta C^{'}}{k_{C}S_{C}})^{2}+(\frac{\Delta H^{'}}{k_{H}S_{H}})^{2}+R_{T}\cdot{(\frac{\Delta C^{'}}{k_{C}S_{C}})}\cdot (\frac{\Delta H^{'}}{k_{H}S_{H}})}
\end{aligned}
\end{equation}
\textbf{（1）明度差与平均明度}
\begin{equation}
\begin{aligned}
   &\Delta L^{'} = L^{*}_{2}-L^{*}_{1},\ \ \overline{L}=\frac{L^{*}_{2}-L^{*}_{1}}{2}
\end{aligned}
\end{equation}
\textbf{（2）色度差与平均色度}
\begin{equation}
\begin{aligned}
  &C_{1}=\sqrt{a^{*2}_{1}+b^{*2}_{1}},\ \ C_{2}=\sqrt{a^{*2}_{2}+b^{*2}_{2}},\ \ \Delta C^{'}=C_{2}-C_{1},\ \ \overline{C}=\frac{C_{1}+C_2}{2}
\end{aligned}
\end{equation}
\textbf{（3）色相角差与平均色相角}
\begin{equation}
\begin{aligned}
 &h_{1}=\arctan2(b^{*}_{1},a^{*}_{1}),\ \ h_{2}=\arctan2(b^{*}_{2},a^{*}_{2})\\
 &\Delta h^{'}=h_{2}-h_{1},\ \ \Delta H^{1}=2\sqrt{C_{1}C_{2}}\sin (\frac{\Delta h^{'}}{2})\\
 &\overline{h}=
 \begin{cases}
   \frac{h_{1}+h_{2}}{2},\ \ |h_{1}-h_{2}|>180^{\circ}\\
   \frac{h_{1}+h_{2}+360^{\circ}}{2},\ \ |h_{1}-h_{2}|\leq 180^{\circ}
 \end{cases}
\end{aligned}
\end{equation}
\textbf{（4）调整因子}
\begin{equation}
\begin{aligned}
  &G=0.5(1-\sqrt{\frac{\overline{C^{7}}}{\overline{C^{7}}+25^{7}}})\\
  &T=1-0.17\cos(\overline{h}-30^{\circ})+0.24\cos(2\overline{h})+0.32\cos(3\overline{h}+6^{\circ})-0.20\cos(4\overline{h}-63^{\circ})
\end{aligned}
\end{equation}
\textbf{（5）权重因子}
\begin{equation}
\begin{aligned}
 &S_{L}=1+\frac{0.015(L-50)^{2}}{\sqrt{20+(\overline{L}-50)^{2}}},\ \ S_{C}=1+0.045\overline{C},\ \ S_{H}=1+0.015\overline{C}T
\end{aligned}
\end{equation}
\textbf{（6）旋转补偿因子}
\begin{equation}
\begin{aligned}
 &R_{T}=-\sin(2\Delta \theta)\cdot R_{C},\ \ \Delta \theta=30\exp\{-(\frac{\overline{h}-275^{\circ}}{25})^{2}\},\ \ R_{C}=2\sqrt{\frac{\overline{C^{7}}}{\overline{C^{7}}+25^{7}}}
\end{aligned}
\end{equation}
其中：$\Delta L^{'}$ :明度差，$\Delta C^{'}$ :色度差，$\Delta H^{'}$ :色相差，$S_{L},S_{C},S_{H}$ :感知缩放因子，$k_{L}=k_{C}=k_{H}=1$ :常用单位权重。

由上述公式，可以计算出两个 CIELab值 的色差。该函数对人眼感知差异具有良好拟合性能，因此被广泛用于图像质量、颜色匹配等领域。

